
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ADMINISTRATION LINUX - sujet 1 &#8212; Book - BTS SIO</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Intro Cours 2" href="../cours2/intro.html" />
    <link rel="prev" title="Bienvenue" href="../intro.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Book - BTS SIO</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Bienvenue
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Cours 1
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   ADMINISTRATION LINUX - sujet 1
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  cours 2
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../cours2/intro.html">
   Intro Cours 2
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../cours2/tp/tp1.html">
     Cours 2 - TP - TP 1
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../cours2/tp/tp2.html">
     Cours 2 - TP - TP 2
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/cours1/cron.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/csuire01/Book - BTS SIO - Lycée de la venise verte"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/csuire01/Book - BTS SIO - Lycée de la venise verte/issues/new?title=Issue%20on%20page%20%2Fcours1/cron.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   ADMINISTRATION LINUX - sujet 1
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#planification-de-tache">
   PLANIFICATION DE TÂCHE
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#introduction">
     Introduction
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#prerequis">
       Prérequis:
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#utilisation-du-daemon-cron">
     Utilisation du daemon cron
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#la-commande-crontab">
       La commande crontab
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#travaux-pratiques-1">
     Travaux pratiques 1
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#les-variables-cron">
       Les variables CRON
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#les-taches-planifiees">
       Les tâches planifiées
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#nom-du-script-tp-cron1-sh">
   Nom du script: tp_cron1.sh
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#les-logs-cron">
     Les logs CRON
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#logger-les-erreurs">
       Logger les erreurs
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#log-systeme">
     Log système
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gerer-les-permissions-dexecution-de-cron">
     Gérer les permissions d’exécution de CRON
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>ADMINISTRATION LINUX - sujet 1</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   ADMINISTRATION LINUX - sujet 1
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#planification-de-tache">
   PLANIFICATION DE TÂCHE
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#introduction">
     Introduction
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#prerequis">
       Prérequis:
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#utilisation-du-daemon-cron">
     Utilisation du daemon cron
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#la-commande-crontab">
       La commande crontab
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#travaux-pratiques-1">
     Travaux pratiques 1
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#les-variables-cron">
       Les variables CRON
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#les-taches-planifiees">
       Les tâches planifiées
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#nom-du-script-tp-cron1-sh">
   Nom du script: tp_cron1.sh
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#les-logs-cron">
     Les logs CRON
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#logger-les-erreurs">
       Logger les erreurs
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#log-systeme">
     Log système
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gerer-les-permissions-dexecution-de-cron">
     Gérer les permissions d’exécution de CRON
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="administration-linux-sujet-1">
<h1>ADMINISTRATION LINUX - sujet 1<a class="headerlink" href="#administration-linux-sujet-1" title="Permalink to this headline">¶</a></h1>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="planification-de-tache">
<h1>PLANIFICATION DE TÂCHE<a class="headerlink" href="#planification-de-tache" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>CRON est un daemon qui permet d’automatiser l’exécution de programmes ou de scripts de manière récurrente (tous les jours par exemple) ou à une date prédéfinie (par exemple le 1 avril à 10h00).</p>
<div class="section" id="prerequis">
<h3>Prérequis:<a class="headerlink" href="#prerequis" title="Permalink to this headline">¶</a></h3>
<p>Nous allons nous assurer que votre machine soit correctement configurée pour récupérer l’heure et la date depuis un serveur ntp:</p>
<ol class="simple">
<li><p>Vérifiez que vous possédez les dernières versions de ntp, ntpq (ntp query) et ntpdate (mise à jour de l’horloge)</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>apt-get update
apt install ntp ntpq ntpdate
</pre></div>
</div>
<ol class="simple">
<li><p>Vérifiez l’état du service ntp</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>service ntp status
</pre></div>
</div>
<ol class="simple">
<li><p>Vérifiez l’état des serveurs ntp
Les serveurs sont mentionnés dans votre fichier /etc/ntp.conf.</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ntpq -p
</pre></div>
</div>
<ol class="simple">
<li><p>Par défaut, votre système utilisera l’heure universelle (UTC). Lancez timedatectl.</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>timedatectl
</pre></div>
</div>
<p>La ligne Time zone: Etc/UTC (UTC, +0000)vous indique que l’heure système est basé sur l’heure universelle. Il faudra changer de fuseau horaire pour passer à l’heure française.</p>
<ol class="simple">
<li><p>Pour changer de fuseau horaire (Europe/Paris)</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>timedatectl set-timezone Europe/Paris
</pre></div>
</div>
<ol class="simple">
<li><p>Relancez timedatectl et vérifiez que fuseau horaire soit bien celui de Paris  Time zone: Europe/Paris (CET, +0100)</p></li>
</ol>
</div>
</div>
<div class="section" id="utilisation-du-daemon-cron">
<h2>Utilisation du daemon cron<a class="headerlink" href="#utilisation-du-daemon-cron" title="Permalink to this headline">¶</a></h2>
<p>Fonctionnement
Les tâches planifiées sont définies à partir de fichiers crontab. Chaque utilisateur à la possibilité de planifier une tâche avec la commande crontab, qui créera un crontab dédié à cet l’utilisateur.  Ces fichiers crontab sont stockés dans le répertoire  /var/spool/cron/crontabs/<utilisateur> pour tous les utilisateurs  (root inclus). Notez qu’il existe un /etc/crontab qui est exclusivement réservé pour les tâches système du daemon cron; donc, nous ne l’utiliserons pas.</p>
<div class="section" id="la-commande-crontab">
<h3>La commande crontab<a class="headerlink" href="#la-commande-crontab" title="Permalink to this headline">¶</a></h3>
<p>crontab est la commande qui va nous permettre d’ajouter, supprimer ou lister les entrées des tables utilisées par le démon cron.</p>
<p>Liste non exhaustives des options de crontab</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Commande</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>crontab -e</p></td>
<td><p>Édite le fichier crontab de l’utilisateur /var/spool/cron/crontab/<user>. Il sera créé s’il n’existe pas.</p></td>
</tr>
<tr class="row-odd"><td><p>-crontab -l</p></td>
<td><p>Affiche le fichier /var/spool/cron/crontab/<votre utilisateur>.</p></td>
</tr>
<tr class="row-even"><td><p>crontab -r</p></td>
<td><p>Supprime le fichier  /var/spool/cron/crontab/<votre utilisateur></p></td>
</tr>
<tr class="row-odd"><td><p>crontab -u <utilisateur></p></td>
<td><p>Permute d’utilisateur pour le fichier crontab. Il faudra ajouter l’option que vous désirez à la suite.  Cette option nécessite des privilèges root.</p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
<blockquote>
<div><p>Pour la liste complète faite <code class="docutils literal notranslate"><span class="pre">man</span> <span class="pre">crontab</span></code></p>
</div></blockquote>
</div>
</div>
<div class="section" id="travaux-pratiques-1">
<h2>Travaux pratiques 1<a class="headerlink" href="#travaux-pratiques-1" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>Utilisez la commande crontab pour créer votre fichier crontab. Lors de la première exécution de crontab vous demandera de choisir un éditeur de texte, choisissez nano.</p></li>
<li><p>Supprimez tous les commentaires</p></li>
<li><p>Remplacez ceci (faites un copier/coller), enregistrez et quittez.</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="se">\#</span> Fichier crontab
<span class="nv">SHELL</span><span class="o">=</span>/bin/sh
<span class="nv">PATH</span><span class="o">=</span>/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
<span class="c1"># Exemple de planification de tache:</span>
<span class="c1"># .---------------- Minute (0 - 59)</span>
<span class="c1"># |  .------------- Heure (0 - 23)</span>
<span class="c1"># |  |  .---------- Jour du mois (1 - 31)</span>
<span class="c1"># |  |  |  .------- Mois (1 - 12) OR jan,feb,mar,apr ...</span>
<span class="c1"># |  |  |  |  .---- Jour de la semaine (0 - 6) oubien sun, mon, tue, wed ...</span>
<span class="c1"># |  |  |  |  |</span>
<span class="c1"># *  *  *  *  * commande</span>
</pre></div>
</div>
<ol class="simple">
<li><p>Créez un nouvel utilisateur “user1”</p></li>
<li><p>Loguez vous avec cet utilisateur “user1”</p></li>
<li><p>Utilisez <code class="docutils literal notranslate"><span class="pre">crontab</span> <span class="pre">-e</span></code> pour éditer le fichier crontab de l’utilisateur “user1”</p></li>
<li><p>Supprimez tous les commentaires</p></li>
<li><p>Ajoutez la ligne:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Crontab de l’utilisateur user1”</span>
</pre></div>
</div>
<p>et enregistrez vos modifications
9. Reconnectez-vous avec root
10. Rendez-vous dans le répertoire /var/spool/cron/crontab
11. Quels fichiers sont présents ?
12. Quels sont leurs contenus ?</p>
<div class="section" id="les-variables-cron">
<h3>Les variables CRON<a class="headerlink" href="#les-variables-cron" title="Permalink to this headline">¶</a></h3>
<p>$PATH : La variable PATH définit le chemin par défaut où se trouve les commandes que vous souhaitez exécuter. Si la commande que vous exécutez n’est pas présente dans le PATH, votre tâche ne sera pas exécutée. Pour régler cela vous pouvez soit :</p>
<ul class="simple">
<li><p>utiliser le chemin absolu de la commande</p></li>
<li><p>modifier la variable cron PATH.</p></li>
</ul>
<p><strong>$SHELL</strong>: Définit le shell que cron devra utiliser pour exécuter vos tâches. Il en existe plusieurs (sh, bash ,ksh, etc …). Nous n’utilisons pas de shell spécifique pour ce TP. Lancez les valeurs par défaut.</p>
<p>**<span class="math notranslate nohighlight">\(HOME**: La variable \)</span>HOME peut être définie dans crontab si vous avez besoin de mentionner un répertoire de travail spécifique. Nous n’utilisons pas cette variable dans ce TP.</p>
<p><strong>$MAILTO</strong> : permet la notification par <a class="reference external" href="http://e-mail.Il">e-mail.Il</a> est possible de mentionner liste de destinataire en séparant par des virgules les adresses. Dans ce TP MAILTO sera défini vide (MAILTO = “”), aucun mail ne sera envoyé.</p>
</div>
<div class="section" id="les-taches-planifiees">
<h3>Les tâches planifiées<a class="headerlink" href="#les-taches-planifiees" title="Permalink to this headline">¶</a></h3>
<p>Pour afficher la liste des tache faite crontab -l.</p>
<p>Chaque ligne représente une tâche et procèdent 6 paramètres séparés d’un espace:</p>
<ol class="simple">
<li><p>Les minutes</p></li>
<li><p>Les heures</p></li>
<li><p>Le jour</p></li>
<li><p>Le mois</p></li>
<li><p>Le jour de la semaine</p></li>
<li><p>La commande a exécuter</p></li>
</ol>
<p>Voici un exemple où root exécute le script <a class="reference external" href="http://full-backup.sh">full-backup.sh</a> à 23:30 le 15 mai :
30 23 15 05* /root/scripts/full-backup.sh</p>
<ul class="simple">
<li><p>30 – la 30ème minute</p></li>
<li><p>23– de la 23ème heure</p></li>
<li><p>15– du 15ème jour</p></li>
<li><p>05– du 5ème mois (soit mai)</p></li>
<li><p>– n’importe quel jour de la semaine</p></li>
</ul>
<p>Les  différents paramètres:
Position
Paramètres
Valeurs possibles
1er champs
Les minutes
0-59
2ème champs
Les heures
0-23
3ème champs
Le jour du mois
0-31
4ème champs
Le mois
1-12 ou
jan, fev, mar, apr, may, jun, etc…
5ème champs
Le jour de la semaine
0-6 où 0=dimanche
sun, mon, tue, wed, thu, fri, sat
6ème champs
Commande
Vous devez  respecter la syntaxe du SHELL définit dans la variable $SHELL. Pour nous ce sera sh. Sont autorisés les pipelines et redirections.</p>
<p>Travaux pratiques 2</p>
<p>Pour chaque champs (unité de temps), minute, heure, jour, mois et jour de la semaine, on peut utiliser :</p>
<ol class="simple">
<li><p>Une valeur afin définir une date et/ou une horaire
Exemple1
30 23 15 05 * /root/scripts/full-backup.sh
30 → la 30ème minute
23 → de la 23ème heure
15 → du 15ème jour
05 → du 5ème mois (soit mai)</p></li>
</ol>
<ul class="simple">
<li><p>→ peu importe le  jour de la semaine</p></li>
</ul>
<p>Soit à 23h30 le 15 mai</p>
<p>Travaux pratiques: Faite la même chose pour mais pour le 10 septembre à 8h30</p>
<p>Exemple 2
30 23 * * mon /root/scripts/full-backup.sh
30 → la 30ème minute
23 → de la 23ème heure</p>
<ul class="simple">
<li><p>→ tous les jours</p></li>
<li><p>→ tous les mois
mon → le lundi</p></li>
</ul>
<p>Soit à 23h30 tous les lundis, puisque l’on a définit quelques que soit les jours et le mois</p>
<p>Travaux pratiques: Faite la même chose mais pour les mardis</p>
<ol class="simple">
<li><p>Un astérix (*) indique toutes les unités de temps. C’est à dire toutes les minutes si un astérix est positionné dans le champs minutes, toutes les heures si un * est positionné dans le champ heure, etc…</p></li>
</ol>
<p>Exemple 3
0 8 * * * /root/scripts/launch.sh
0 → la 30ème minute
8→ de la 23ème heure</p>
<ul class="simple">
<li><p>→ tous les jours</p></li>
<li><p>→ tous les mois</p></li>
<li><p>→ peu importe le  jour de la semaine</p></li>
</ul>
<p>Soit à 8h00 tous les jours</p>
<p>Travaux pratiques: Faite la même chose mais à 18h15</p>
<ol class="simple">
<li><p>La virgule permet de définir plusieurs valeurs distinctes. Par exemple: 14,18 positionné dans le champ heure exécutera la commande à 14 et 18 heures.</p></li>
</ol>
<p>Exemple 4
0 14,18 * * * /root/scripts/launch.sh
0 → la 0ème minute, soit à pile
14,18 → de la 14ème et la 18ème heure</p>
<ul class="simple">
<li><p>→ tous les jours</p></li>
<li><p>→ tous les mois</p></li>
<li><p>→ peu importe le  jour de la semaine</p></li>
</ul>
<p>Soit à 14h et 18h tous les jours</p>
<p>Travaux pratiques: Faite la même chose mais à 14h les lundi et mardi
4. Le tiret du 6 (-) pour définir une plage d’unité de temps. Par exemple 1-5 est équivalent à 1,2,3,4,5. La commande sera exécutée à chaque unité de temps inclus dans la plage concernée.</p>
<p>Exemple 5
0 23 * * * /root/scripts/check.sh
0 → la 30ème minute
23 → de la 23ème heure</p>
<ul class="simple">
<li><p>→ tous les jours
1-6  → tous les mois de janvier à juin</p></li>
<li><p>→ peu importe le  jour de la semaine</p></li>
</ul>
<p>Soit à 23h tous les jours du mois de janvier au mois de juin</p>
<p>Travaux pratiques: Faite la même chose du mois de juillet à décembre</p>
<ol class="simple">
<li><p>/ la barre oblique permet de définir une intervalle d’unité de temps. Par exemple */15 positionné sur le champs minutes, exécutera la commande toute les 15 minutes. */6 positionné sur les mois exécutera la commande tous les 6 mois.</p></li>
</ol>
<p>Exemple 6
*/15 * * * * /root/scripts/check_mail.sh
*/15 → prend toutes les valeurs avec une intervalle de 15 minutes</p>
<ul class="simple">
<li><p>→ toutes les heures</p></li>
<li><p>→ tous les jours</p></li>
<li><p>→ tous les mois</p></li>
<li><p>→ peu importe le  jour de la semaine</p></li>
</ul>
<p>Soit toutes les 15 minutes</p>
<p>Travaux pratiques: Faite la même chose toutes les 10 jours à 8h00</p>
<p>Notez qu’il existe des raccourcis:</p>
<ul class="simple">
<li><p>&#64;reboot                 Lancement une fois au démarrage.</p></li>
<li><p>&#64;yearly                 Lancement une fois par an (remplace: 0 0 1 1 *)</p></li>
<li><p>&#64;monthly                 Lancement une fois par mois (remplace: 0 0 1 * *)</p></li>
<li><p>&#64;weekly                 Lancement une fois par semaine (remplace: 0 0 * * 0)</p></li>
<li><p>&#64;daily                 Lancement une fois par jour (remplace: 0 0 * * *)</p></li>
<li><p>&#64;hourly                 Lancement une fois par heure (remplace: 0 * * * *)</p></li>
</ul>
<p>Exemple 7
0 8,17 * */3 mon,fri /root/scripts/check_mail.sh
0 → la 0ème minute
8,17 → La 8ème et 17ème heure</p>
<ul class="simple">
<li><p>→ Peut importe le jour
*/3 → tous les 3 mois
mon,fri → Uniquement les lundi et vendredi</p></li>
</ul>
<p>Soit à 8h et 17h tous les 3 mois uniquement les lundis et vendredi</p>
<p>Exercices
Créer le script tp_cron1.sh
nano tp_cron1.sh</p>
<p>Ce script affiche la date et l’heure comme ceci: “13/02/21 09:44:27”
#!/bin/bash</p>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="id1">
<h1><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="nom-du-script-tp-cron1-sh">
<h1>Nom du script: tp_cron1.sh<a class="headerlink" href="#nom-du-script-tp-cron1-sh" title="Permalink to this headline">¶</a></h1>
<p>date “+%d/%m/%y %H:%M:%S”</p>
<p>Pensez à ajouter les droits en exécution à votre script.
chmod +x tp_cron1.sh</p>
<ol class="simple">
<li><p>Ajoutez une tache qui exécutera le script <a class="reference external" href="http://tp-cron.sh">tp-cron.sh</a> toutes les minutes</p></li>
<li><p>Ajoutez tâche qui exécutera le script <a class="reference external" href="http://tp-cron.sh">tp-cron.sh</a> à 10, 25 et 45 minutes</p></li>
<li><p>Ajoutez tâche qui exécutera le script <a class="reference external" href="http://tp-cron.sh">tp-cron.sh</a> à 10h15 tous les jours</p></li>
<li><p>Ajoutez une tache qui exécutera le script <a class="reference external" href="http://tp-cron.sh">tp-cron.sh</a> tous les jours de 8 à 17h heure.</p></li>
<li><p>Ajoutez une tache qui exécutera le script <a class="reference external" href="http://tp-cron.sh">tp-cron.sh</a> toute la journée 1 heure sur 2</p></li>
<li><p>Sans utiliser le raccourci &#64;monthly lancez  le script <a class="reference external" href="http://tp-cron.sh">tp-cron.sh</a> une fois par mois</p></li>
<li><p>Lancez le script <a class="reference external" href="http://tp-cron.sh">tp-cron.sh</a> tous les 3 jours.</p></li>
<li><p>Ajouter une tâche qui exécute apt-get update tous les lundi</p></li>
<li><p>Exécutez le script <a class="reference external" href="http://tp-cron.sh">tp-cron.sh</a> une fois par trimestre.</p></li>
<li><p>Envoyez un message aux utilisateurs avec  la commande wall “Message URGENT: C’est bientôt la pause” tous les jeudis à 12h30 de septembre à juin.</p></li>
<li><p>Planifiez une (pseudo) sauvegarde à partir du script <a class="reference external" href="http://sauvegarde.sh">sauvegarde.sh</a> tous les jours sauf les samedis et dimanches à 22h00.</p></li>
<li><p>une (pseudo) sauvegarde à partir du script <a class="reference external" href="http://sauvegarde.sh">sauvegarde.sh</a> tous les lundi les mois de septembre, octobre, novembre, décembre, janvier, février et mars</p></li>
</ol>
<div class="section" id="les-logs-cron">
<h2>Les logs CRON<a class="headerlink" href="#les-logs-cron" title="Permalink to this headline">¶</a></h2>
<div class="section" id="logger-les-erreurs">
<h3>Logger les erreurs<a class="headerlink" href="#logger-les-erreurs" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p><strong>Rappels sur les redirections</strong>
Redirige la sortie standard et la concatène avec le contenu du fichier fichier.log
&gt;&gt; fichier.log
Redirige la sortie standard et écrase le fichier fichier.log
2&gt; fichier.log
Redirige la sortie des erreurs vers le fichier fichier.log</p>
</div></blockquote>
<p><strong>Exemple</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>* * * * * /home/user/myscript.sh &gt;/home/user/myscript.log <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
</pre></div>
</div>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">...</span> <span class="pre">\&gt;</span> <span class="pre">/home/user/myscript.log</span></code> indique à cron de rediriger la sortie standard (STDOUT) vers le fichier /home/user/myscript.log .</p>
<p>Notez que STDOUT sera ajouté e fin de fichier. <code class="docutils literal notranslate"><span class="pre">myscript.log</span></code> ne sera pas écrasé.</p>
<p><code class="docutils literal notranslate"><span class="pre">2&gt;&amp;1</span></code> indique à cron d’envoyer les erreurs (STDERR) vers  la même cible que la sortie normale (STDOUT)</p>
</div></blockquote>
<ol class="simple">
<li><p>Reprenez votre tache de l’exercice 12 et redirigez la sortie standard vers le fichier <code class="docutils literal notranslate"><span class="pre">/var/log/mon_cron.log</span></code></p></li>
<li><p>Reprenez votre tache de l’exercice 12 et redirigez la sortie erreur vers le fichier <code class="docutils literal notranslate"><span class="pre">/var/log/erreurs_cron.log</span></code></p></li>
</ol>
</div>
</div>
<div class="section" id="log-systeme">
<h2>Log système<a class="headerlink" href="#log-systeme" title="Permalink to this headline">¶</a></h2>
<p>Le daemon CRON laisse des traces dans le log système /var/log/syslog :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat /var/log/syslog
</pre></div>
</div>
<p>Sans surprise, ce log est très chargé.</p>
<p>Si vous souhaitez filtrer ce fichier de logs et afficher uniquement les lignes impliquant CRON, faite:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>grep CRON /var/log/syslog
</pre></div>
</div>
</div>
<div class="section" id="gerer-les-permissions-dexecution-de-cron">
<h2>Gérer les permissions d’exécution de CRON<a class="headerlink" href="#gerer-les-permissions-dexecution-de-cron" title="Permalink to this headline">¶</a></h2>
<p>Par défaut les distributions Debian (et dérivés) autorisent tous les utilisateurs à planifier une tâche avec CRON. Si besoin, il est possible de filtrer les utilisateurs ayant le droit d’accéder au daemon CRON.</p>
<ul class="simple">
<li><p>Si le fichier /etc/cron.allow existe, vous devez y figurer (un utilisateur par ligne) pour être autorisé à utiliser crontab.</p></li>
<li><p>Si le fichier /etc/cron.allow n’existe pas mais que /etc/cron.deny existe, vous ne devez pas y être répertorié. Faute de quoi, votre utilisateur ne sera plus autorisé à utiliser crontab.</p></li>
<li><p>Si les 2 fichiers /etc/cron.allow et /etc/cron.deny existent, le fichier /etc/cron.allow sera prioritaire et /etc/cron.deny ignoré.</p></li>
<li><p>Si aucun de ces fichiers ne sont présent, par défaut Debian autorise tous les utilisateurs à utiliser crontab.</p></li>
</ul>
<ol class="simple">
<li><p>A l’aide du fichiers cron.allow, autorisez uniquement root à planifier une tâche</p></li>
<li><p>Créer un second utilisateur “user2”. Loguez-vous avec l’utilisateur user2. Essayez de planifier une tâche. Quel résultat obtenez-vous ?</p></li>
<li><p>Reconnectez-vous avec root. Ajoutez “user2” comme utilisateur autorisé à planifier une tâche.</p></li>
<li><p>Loguez-vous avec l’utilisateur user2.</p></li>
<li><p>Essayez de planifier une tâche. Quel résultat obtenez-vous ?</p></li>
</ol>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./cours1"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="../intro.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Bienvenue</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../cours2/intro.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Intro Cours 2</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Jean-François Ornech - Lycée de la venise verte<br/>
    
        &copy; Copyright 2022.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>